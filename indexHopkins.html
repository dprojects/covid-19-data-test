<!DOCTYPE html>
<html>
 <head>
  <title>covid-19-data-test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" />
 </head>
 
 <style>
    table td {
        padding: 5px 15px;
        border-bottom: 1px dotted red;
    }
    .title {
        font-size: 30px;
        font-weight: bold;
        background-color: #DDDDFF;
        margin: 15px 0px 5px 0px;
    }
 </style>
 
 <body>
  
  <div class="title">Invalid Confirmed Data</div><div id="C"></div>
  <div class="title">Invalid Death Data</div><div id="D"></div>
  <div class="title">Invalid Recovered Data</div><div id="R"></div>
  
  <script type="text/javascript">
    
    function setRow(a, b, c, d, e) {
    
        let td = '<tr>';
        td += '<td>'+a+'</td>';
        td += '<td>'+b+'</td>';
        td += '<td>'+c+'</td>';
        td += '<td>'+d+'</td>';
        td += '<td>'+e+'</td>';
        td += '</tr>';
        
        return td;
    }
    
    function showInvalidData(path, type) {
        fetch(path)
        .then(response => response.text())
        .then(data => {
            
            let aData = data.split('\n');
            let aKeys = aData.length-2;
            let aHeader = aData[0].split(',');
            
            let output = '<table>';
            
            output += setRow( '<b>Place</b>', '<b>Index</b>', '<b>Date</b>', '<b>Type</b>', '<b>Value</b>');
            
            for (let k=1; k < aKeys; k++) {
                
                let row = aData[k].split(',');
                let s = row.length-1;
                let key = row[0]; if (key === '') { key = row[1]; } // for CSV bug
                let maxR = parseInt(row[s]);
                
                for (let i=s; i>5; i--) {
                    
                    let p = i-1;   // previous index 
                    
                    if (parseInt(row[p]) > maxR) {
                        output += setRow( key, p, aHeader[p], type, row[p] );
                    } else {
                        maxR = parseInt(row[p]); // replace higher value with last correct one
                    }
                }
            } 
            output += '</table>';
            
            if (type === "Confirmed") { document.getElementById("C").innerHTML = output; }
            if (type === "Deaths") { document.getElementById("D").innerHTML = output; }
            if (type === "Recovered") { document.getElementById("R").innerHTML = output; }
        });
    }
    
    showInvalidData("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv", "Confirmed");
    
    showInvalidData("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv", "Deaths");
    
    showInvalidData("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv", "Recovered");
    
  </script>
  
 </body>
</html>
